"use strict";angular.module("myApp",["ngRoute","ui.router","datePicker"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("homeview",{url:"/",templateUrl:"static/events/day-range/day-range.html",controller:"DayRangeController",controllerAs:"dr"}).state("events",{url:"/events?city&year&month&day&range",templateUrl:"static/events/events.html",controller:"EventsCtrl",controllerAs:"events"})}]),function(){function ControlRowController($state,$scope){function init(){vm.state=$state.current.name,vm.menus={open:!1,state:""},vm.search={open:!1},vm.citiesObj=[{name:"Turku"},{name:"Vaasa"},{name:"Jyvaskyl√§"},{name:"Helsinki"},{name:"Tampere"},{name:"Rauma"},{name:"Pori"},{name:"Lappeenranta"},{name:"Kuopio"},{name:"Joensuu"},{name:"Savonlinna"}],vm.startDateOpen=!1,vm.endDateOpen=!1,vm.lastRowCount=vm.citiesObj.length-vm.citiesObj.length%3}var vm=this;vm.updateDays=function(){var cities=[];angular.forEach(vm.citiesObj,function(city){city.selected&&cities.push(city.name)}),0===cities.length&&(cities="all"),vm.startDate&&vm.endDate&&vm.update(cities,vm.startDate,vm.endDate)},vm.toggleMenu=function(state){vm.menus.open&&vm.menus.state==state?vm.closeMenu(state):vm.openMenu(state)},vm.openMenu=function(state){vm.menus.open=!0,vm.menus.state=state},vm.closeMenu=function(){vm.menus.open=!1,vm.menus.state=""},vm.openSearch=function(){vm.search.open=!0},vm.closeSearch=function(){vm.search.open=!1},vm.today=function(){var now=new Date;vm.startDate=now,vm.endDate=now,vm.updateDays()},vm.thisWeek=function(){var startDate=new Date,weekday=startDate.getDay();0===weekday?weekday=6:weekday-=1,vm.startDate=new Date((new Date).setDate(startDate.getDate()-weekday)),vm.endDate=new Date((new Date).setDate(vm.startDate.getDate()+6)),vm.updateDays()},vm.focusStartDate=function(){vm.startDateOpen=!0},vm.focusEndDate=function(){vm.endDateOpen=!0},$scope.$watch("cr.startDate",function(){vm.updateDays()}),$scope.$watch("cr.endDate",function(){vm.updateDays()}),init()}angular.module("myApp").controller("ControlRowController",ControlRowController),ControlRowController.$inject=["$state","$scope"]}(),function(){function mainMenu(){return{templateUrl:"static/components/control-row/control-row.html",bindToController:!0,controller:"ControlRowController as cr",scope:{city:"=",startDate:"=",endDate:"=",update:"=",visibleFilter:"="}}}angular.module("myApp").directive("controlRow",mainMenu)}(),function(){function EventsCtrl(){function init(){}init()}angular.module("myApp").controller("EventsCtrl",EventsCtrl),EventsCtrl.$inject=[]}(),function(){function Events($http){this.getEvents=function(year,month,day){return $http.get("api/events/as-dates/"+year+"/"+month+"/"+day)},this.getDay=function(year,month,day){return $http.get("api/events/as-dates/"+year+"/"+month+"/"+day)},this.getDateList=function(cities,year,month,day,daterange){if("all"===cities)return $http.get("api/events/query?",{params:{year:year,month:month,day:day,daterange:daterange}});var cityString="";return angular.forEach(cities,function(city){cityString+=city+","}),cityString=cityString.substring(0,cityString.length-1),$http.get("api/events/query?",{params:{cities:cityString,year:year,month:month,day:day,daterange:daterange}})}}angular.module("myApp").service("Events",Events),Events.$inject=["$http"]}(),function(){function DayController($stateParams,Events){function init(){}init()}angular.module("myApp").controller("DayController",DayController),DayController.$inject=["$stateParams","Events"]}(),function(){function DayRangeController($stateParams,Events){function loadEvents(cities,startDate,endDate){var dateRange=Math.round((endDate-startDate)/864e5);Events.getDateList(cities,startDate.getFullYear(),startDate.getMonth()+1,startDate.getDate(),dateRange+1).success(function(response){vm.dates=response}).error(function(){})}function init(){$stateParams.cities?vm.cities=$stateParams.cities:vm.cities="all";var startDate=new Date,weekday=startDate.getDay();0===weekday?weekday=6:weekday-=1,vm.startDate=new Date((new Date).setDate(startDate.getDate()-weekday)),vm.endDate=new Date((new Date).setDate(vm.startDate.getDate()+6)),vm.selectedEvent={active:!1,event:{}},vm.visibleFilter="",loadEvents(vm.cities,vm.startDate,vm.endDate)}var vm=this;vm.updateEvents=function(city,startDate,endDate){loadEvents(city,startDate,endDate)},vm.openEvent=function(dayIndex,eventIndex){vm.selectedEvent.active||(vm.dates[dayIndex].events[eventIndex].selected=!0,vm.selectedEvent={active:!0,dayIndex:dayIndex,eventIndex:eventIndex})},vm.closeEvent=function(){vm.dates[vm.selectedEvent.dayIndex].events[vm.selectedEvent.eventIndex].selected=!1,vm.selectedEvent.active=!1},init()}angular.module("myApp").controller("DayRangeController",DayRangeController),DayRangeController.$inject=["$stateParams","Events"]}();